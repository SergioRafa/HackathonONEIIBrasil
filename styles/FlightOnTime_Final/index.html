<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight On Time - Dashboard IA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles/style.css">
</head>
<body>
    <main class="apresentacao">
        <section class="apresentacao__conteudo">
            <h1 class="apresentacao__conteudo__titulo">‚úàÔ∏è Flight <span class="titulo-destaque">On Time</span></h1>
            <p>Monitoramento Preditivo de Opera√ß√µes A√©reas</p>
            
            <form id="meuFormulario" class="pesquisar">
                <div class="input-group">
                    <label><i class="fas fa-plane-departure"></i> Aeroporto Origem</label>
                    <input type="text" id="origem" placeholder="Ex: GIG" maxlength="3" oninput="this.value = this.value.toUpperCase()">
                </div>
                
                <div class="input-group">
                    <label><i class="fas fa-plane-arrival"></i> Aeroporto Destino</label>
                    <input type="text" id="destino" placeholder="Ex: GRU" maxlength="3" oninput="this.value = this.value.toUpperCase()">
                </div>
                
                <div class="input-group">
                    <label><i class="fas fa-route"></i> Dist√¢ncia (Km)</label>
                    <input type="number" id="distanciaKm" placeholder="Ex: 500">
                </div>
                
                <div class="input-group">
                    <label><i class="fas fa-calendar-alt"></i> Data do Voo</label>
                    <input type="date" id="dataPartida">
                </div>
                
                <button type="button" id="btn-analisar" onclick="enviarDados(event)">
                    <i class="fas fa-microchip"></i> EXECUTAR AN√ÅLISE IA
                </button>
            </form>

            <div id="resultado" class="resultado-container" style="display: none;">
                <div id="mensagem-retorno"></div>
            </div>
        </section>
        
        <img class="apresentacao__imagem" src="assets/aviao.png" alt="Avi√£o">
    </main>

    <script>
        async function enviarDados(event) {
            const btn = document.getElementById('btn-analisar');
            const msg = document.getElementById('mensagem-retorno');
            const resDiv = document.getElementById('resultado');

            resDiv.style.display = 'block';
            resDiv.className = 'resultado-container';
            msg.innerHTML = "üõ∞Ô∏è Processando an√°lise de risco...";
            btn.disabled = true;

            const dados = {
                companhia: "Latam",
                origem: document.getElementById('origem').value,
                destino: document.getElementById('destino').value,
                dataPartida: document.getElementById('dataPartida').value + "T12:00:00",
                distanciaKm: parseInt(document.getElementById('distanciaKm').value)
            };

            try {
                const response = await fetch('https://uncompulsive-shelly-nonclerically.ngrok-free.dev/api/previsao/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'ngrok-skip-browser-warning': 'true' },
                    body: JSON.stringify(dados)
                });
                const res = await response.json();
                const prob = Math.round(res.probabilidade <= 1 ? res.probabilidade * 100 : res.probabilidade);
                
                let classe = prob <= 15 ? 'resultado-sucesso' : (prob <= 40 ? 'resultado-alerta' : 'resultado-perigo');
                resDiv.className = `resultado-container ${classe}`;
                msg.innerHTML = `<h2>Risco: ${prob}%</h2><p>An√°lise de tr√°fego e clima conclu√≠da.</p>`;
            } catch (e) {
                resDiv.className = 'resultado-container resultado-perigo';
                msg.innerHTML = "‚ùå Erro na conex√£o.";
            } finally {
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>