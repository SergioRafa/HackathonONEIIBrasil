<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight On Time - IA Preditiva</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/style.css">
</head>
<body>
    <main class="apresentacao">
        <section class="apresentacao__conteudo">
            <h1 class="apresentacao__conteudo__titulo">
                <i class="fas fa-plane-departure"></i> Flight <strong class="titulo-destaque">On Time</strong>
            </h1>
            <p class="apresentacao__conteudo__texto">An√°lise de atrasos em tempo real via Intelig√™ncia Artificial.</p>
            
            <form id="meuFormulario" class="pesquisar">
                <div class="input-group">
                    <i class="fas fa-location-dot"></i>
                    <input type="text" id="origem" placeholder="Origem (Ex: GIG)" maxlength="3" 
                           oninput="this.value = this.value.toUpperCase()" required>
                </div>
                
                <div class="input-group">
                    <i class="fas fa-plane-arrival"></i>
                    <input type="text" id="destino" placeholder="Destino (Ex: JFK)" maxlength="3" 
                           oninput="this.value = this.value.toUpperCase()" required>
                </div>
                
                <div class="input-group">
                    <i class="fas fa-route"></i>
                    <input type="number" id="distanciaKm" placeholder="Dist√¢ncia (km)" min="1" required>
                </div>
                
                <div class="input-group">
                    <i class="fas fa-calendar-day"></i>
                    <input type="date" id="dataPartida" required>
                </div>
                
                <button type="button" id="btn-analisar" onclick="enviarDados(event)">
                    <i class="fas fa-microchip"></i> EXECUTAR AN√ÅLISE PROFISSIONAL
                </button>
            </form>

            <div id="resultado" class="resultado-container" style="display: none;">
                <div id="mensagem-retorno"></div>
            </div>
        </section>
        
        <div class="imagem-container">
            <img class="apresentacao__imagem" src="assets/aviao.png" alt="Avi√£o">
        </div>
    </main>

    <script>
        // Bloqueia datas passadas ao carregar a p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            const hoje = new Date().toISOString().split("T")[0];
            document.getElementById('dataPartida').setAttribute('min', hoje);
        });

        async function enviarDados(event) {
            event.preventDefault();

            const btn = document.getElementById('btn-analisar');
            const msg = document.getElementById('mensagem-retorno');
            const resDiv = document.getElementById('resultado');

            const origem = document.getElementById('origem').value;
            const destino = document.getElementById('destino').value;
            const distancia = document.getElementById('distanciaKm').value;
            const data = document.getElementById('dataPartida').value;

            if (!origem || !destino || !distancia || !data) {
                alert("Por favor, preencha todos os campos.");
                return;
            }

            // Feedback Visual de Processamento
            resDiv.style.display = 'block';
            resDiv.className = 'resultado-container'; 
            msg.innerHTML = '<i class="fas fa-satellite fa-spin"></i> Consultando sat√©lites e IA...';
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> PROCESSANDO...';

            const dadosVoo = {
                companhia: "Latam",
                origem: origem.toUpperCase(),
                destino: destino.toUpperCase(),
                dataPartida: data + "T12:00:00",
                distanciaKm: parseInt(distancia)
            };

            try {
                const response = await fetch('https://uncompulsive-shelly-nonclerically.ngrok-free.dev/api/previsao/predict', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'ngrok-skip-browser-warning': 'true' 
                    },
                    body: JSON.stringify(dadosVoo)
                });
                
                if (!response.ok) throw new Error("Erro no servidor");

                const resultado = await response.json();
                const probRaw = resultado.probabilidade;
                const prob = Math.round(probRaw <= 1 ? probRaw * 100 : probRaw);
                
                let classe = '';
                let icone = '';
                
                if (prob <= 15) {
                    classe = 'resultado-sucesso';
                    icone = '<i class="fas fa-check-circle"></i>';
                } else if (prob <= 40) {
                    classe = 'resultado-alerta';
                    icone = '<i class="fas fa-exclamation-triangle"></i>';
                } else {
                    classe = 'resultado-perigo';
                    icone = '<i class="fas fa-radiation"></i>';
                }

                resDiv.className = `resultado-container ${classe}`;
                msg.innerHTML = `
                    <h2>${icone} Risco de Atraso: ${prob}%</h2>
                    <p>${prob <= 15 ? 'Voo com alta tend√™ncia de pontualidade.' : 'Poss√≠vel impacto nas opera√ß√µes detectado.'}</p>
                    <small>üì° Fonte: IA FlightOnTime | StormGlass API</small>
                `;

            } catch (e) {
                resDiv.className = 'resultado-container resultado-perigo';
                msg.innerHTML = '<i class="fas fa-circle-xmark"></i> Erro de conex√£o. Verifique o Back-end.';
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-microchip"></i> EXECUTAR NOVA AN√ÅLISE';
            }
        }
    </script>
</body>
</html>